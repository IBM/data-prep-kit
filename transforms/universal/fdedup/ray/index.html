
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>Fuzzy Dedup - Data Prep Kit</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/badge.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fuzzy-dedup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Data Prep Kit" class="md-header__button md-logo" aria-label="Data Prep Kit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Data Prep Kit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fuzzy Dedup
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/IBM/data-prep-kit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../data-processing-lib/doc/overview/" class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../doc/quick-start/quick-start/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Data Prep Kit" class="md-nav__button md-logo" aria-label="Data Prep Kit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Data Prep Kit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/IBM/data-prep-kit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data-processing-lib/doc/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../doc/quick-start/quick-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QuickStart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data-processing-lib/doc/simplest-transform-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data-processing-lib/doc/advanced-transform-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../kfp/doc/simple_transform_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KFP Pipeline
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transform-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Transform runtime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transform runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tableprocessor-actor" class="md-nav__link">
    <span class="md-ellipsis">
      TableProcessor Actor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docsminhash-actor" class="md-nav__link">
    <span class="md-ellipsis">
      DocsMinHash Actor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bucketshash-actor" class="md-nav__link">
    <span class="md-ellipsis">
      BucketsHash Actor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckethashprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      BucketHashProcessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckethashprocessor_1" class="md-nav__link">
    <span class="md-ellipsis">
      BucketHashProcessor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doccollector-actor" class="md-nav__link">
    <span class="md-ellipsis">
      DocCollector Actor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformer" class="md-nav__link">
    <span class="md-ellipsis">
      Transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshotting" class="md-nav__link">
    <span class="md-ellipsis">
      Snapshotting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building" class="md-nav__link">
    <span class="md-ellipsis">
      Building
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-and-command-line-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration and command line Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    <span class="md-ellipsis">
      Running
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#launched-command-line-options" class="md-nav__link">
    <span class="md-ellipsis">
      Launched Command Line Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Running the samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transforming-data-using-the-transform-image" class="md-nav__link">
    <span class="md-ellipsis">
      Transforming data using the transform image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="fuzzy-dedup">Fuzzy Dedup</h1>
<p>Please see the set of
<a href="../../../">transform project conventions</a>
for details on general project conventions, transform configuration,
testing and IDE set up.</p>
<h2 id="summary">Summary</h2>
<p>The basic implementation of the fuzzy dedup is based on <a href="https://en.wikipedia.org/wiki/MinHash">MinHash</a>. Also see
<a href="http://infolab.stanford.edu/~ullman/mmds/ch3n.pdf">here</a> for more details. The architecture of the implementation is presented here:</p>
<p><img alt="" src="images/fuzzy.png" /></p>
<p>The main components of implementation are driver, processors (implemented as actor pools) - table processor, table 
filter and bucket hash processor, and hash actors - minhash, buckets and docs. </p>
<p>The complication of mapping this model to transform model is the fact that in this model assumes a two pass processing, 
while a transform model is a single pass. The solution to this mismatch is to use transform runtime to implement the 
first path and use the native transform pipeline to implement filtering.</p>
<h2 id="transform-runtime">Transform runtime</h2>
<p>The <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_transform_ray.py">transform runtime</a> is implementing complete first path of the fuzzy deduping:
* creates bucket and minhash collectors
* implements initial file processing to populate bucket and minhash caches
* creates doc collectors 
* implement bucket processing
* Clean up everything except for doc collectors in preparation to filter, that is implemented by the framework proper
The main components of runtime are described below</p>
<h3 id="tableprocessor-actor">TableProcessor Actor</h3>
<p><a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_transform_ray.py">Table processing actor</a> is implemented following framework itself is implemented as a pair -
<code>FdedupTransform</code> implementing the actual transformation and and 
<a href="../../../../data-processing-lib/src/data_processing/runtime/ray/transform_table_processor.py">transform table processor</a> 
(from the framework itself).</p>
<h3 id="docsminhash-actor">DocsMinHash Actor</h3>
<p>This <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_support.py">actor</a> stores MInHashes</p>
<h3 id="bucketshash-actor">BucketsHash Actor</h3>
<p>This actor <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_support.py">actor</a></p>
<h3 id="buckethashprocessor">BucketHashProcessor</h3>
<p>BucketHash <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_support.py">actor</a> implement the actual buckets processing, removing duplicates. 
Implementation of this actor allows to better manage this "expensive" process, by using Actor pool load balancing
thus minimizing overall time for this operation. Instead of pre partitioning buckets, it is using dynamic load
partitioning. We also are processing "longest" buckets first thus further improving performance. To further improve
the overall performance we can in future implement bucket splitting - its faster to process more smaller buckets 
then the long ones</p>
<h3 id="buckethashprocessor_1">BucketHashProcessor</h3>
<p>This <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_support.py">actor</a> is queueing up requests to the <code>BucketHashProcessor</code> actor pool, which load 
balances their execution</p>
<h3 id="doccollector-actor">DocCollector Actor</h3>
<p>This <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_support.py">actor</a> is a collector for unique documents</p>
<h2 id="transformer">Transformer</h2>
<p>In the fuzzy dedup implementation, the <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/fdedup_transform_ray.py">transformer</a> only implements filtering. For every
table, it checks document ids with the <code>DocumentsCollector</code> cache and removes all of the rows which do not have ids in 
the hash </p>
<h2 id="snapshotting">Snapshotting</h2>
<p>Fuzzy dedup often runs on very large data sets and implements three very distinct phases:
* Building buckets
* Processing buckets
* Filtering data
To improve recoverability of fuzzy dedup, current implementation includes snapshotting - at the end of the first two 
phases we snapshot the current state of execution - bucket and minhash actors after the first phase and document actors 
after the second. This snapshotting provide code with the ability to restart from the existing snapshot. You can use one
of two configuration flags (assuming snapshots exist):
* <code>use_bucket_snapshot</code> to start from the second phase
* <code>use_doc_snapshot</code> to start from the third phase</p>
<h2 id="building">Building</h2>
<p>A <a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/Dockerfile">docker file</a> that can be used for building docker image. You can use </p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>make<span class="w"> </span>build<span class="w"> </span>to<span class="w"> </span>build<span class="w"> </span>it
</span></code></pre></div>
<h3 id="configuration-and-command-line-options">Configuration and command line Options</h3>
<p>The set of dictionary keys holding <a href="src/blocklist_transform.py">BlockListTransform</a>
configuration for values are as follows:</p>
<ul>
<li><em>bucket_cpu</em> - specifies number of CPUs for bucket actor</li>
<li><em>doc_cpu</em> - specifies number of CPUs for doc actor</li>
<li><em>mhash_cpu</em> - specifies number of CPUs for minhash actor</li>
<li><em>num_doc_actors</em> - specifies number of doc actors</li>
<li><em>num_bucket_actors</em> - specifies number of bucket actors</li>
<li><em>num_minhash_actors</em> - specifies number of minhash actors</li>
<li><em>num_preprocessors</em> - specifies number of preprocessors</li>
<li><em>num_permutations</em> - specifies number of permutations</li>
<li><em>threshold</em> - specifies threshold</li>
<li><em>shingles_size</em> - specifies shingles size</li>
<li><em>japanese_data</em> - specifies whether to use japanese specific document splitting</li>
<li><em>delimiters</em> - specifies delimiter for non japanese document splitting</li>
<li><em>snapshot_delay</em> - delay between different actors reading/writing snapshot not to overwhelm storage</li>
<li>-use_bucket_snapshot_ - run from the existing buckets snapshot (bypass building buckets)</li>
<li>-use_doc_snapshot_ - run from the existing docs snapshot (bypass building and processing buckets)</li>
</ul>
<p>Above you see both parameters and their values for small runs (tens of files). We also provide an 
<a href="https://github.com/IBM/data-prep-kit/blob/dev/transforms/universal/fdedup/ray/src/cluster_estimator.py">estimate</a> to roughly determine cluster size for running transformer.</p>
<h2 id="running">Running</h2>
<h3 id="launched-command-line-options">Launched Command Line Options</h3>
<p>When running the transform with the Ray launcher (i.e. TransformLauncher),
the following command line arguments are available in addition to
<a href="../../../../data-processing-lib/doc/ray-launcher-options/">the options provided by the launcher</a>.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">  </span>--fdedup_doc_column<span class="w"> </span>FDEDUP_DOC_COLUMN
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">                        </span>document<span class="w"> </span>column<span class="w"> </span>name
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span>--fdedup_id_column<span class="w"> </span>FDEDUP_ID_COLUMN
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">                        </span>integer<span class="w"> </span>document<span class="w"> </span>id<span class="w"> </span>column<span class="w"> </span>name
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span>--fdedup_cluster_column<span class="w"> </span>FDEDUP_CLUSTER_COLUMN
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">                        </span>cluster<span class="w"> </span>column<span class="w"> </span>name
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span>--fdedup_bucket_cpu<span class="w"> </span>FDEDUP_BUCKET_CPU
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>CPUs<span class="w"> </span>per<span class="w"> </span>bucket<span class="w"> </span><span class="nb">hash</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span>--fdedup_mhash_cpu<span class="w"> </span>FDEDUP_MHASH_CPU
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>CPUs<span class="w"> </span>per<span class="w"> </span>minhash<span class="w"> </span><span class="nb">hash</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span>--fdedup_doc_cpu<span class="w"> </span>FDEDUP_DOC_CPU
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>CPUs<span class="w"> </span>per<span class="w"> </span>doc<span class="w"> </span><span class="nb">hash</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span>--fdedup_num_doc_actors<span class="w"> </span>FDEDUP_NUM_DOC_ACTORS
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>doc<span class="w"> </span>actors<span class="w"> </span>to<span class="w"> </span>use
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span>--fdedup_num_minhash_actors<span class="w"> </span>FDEDUP_NUM_MINHASH_ACTORS
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>minhash<span class="w"> </span>actors<span class="w"> </span>to<span class="w"> </span>use
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">  </span>--fdedup_num_bucket_actors<span class="w"> </span>FDEDUP_NUM_BUCKET_ACTORS
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>bucket<span class="w"> </span>actors<span class="w"> </span>to<span class="w"> </span>use
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">  </span>--fdedup_num_preprocessors<span class="w"> </span>FDEDUP_NUM_PREPROCESSORS
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>preprocessors<span class="w"> </span>to<span class="w"> </span>use
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">  </span>--fdedup_num_permutations<span class="w"> </span>FDEDUP_NUM_PERMUTATIONS
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>permutations
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">  </span>--fdedup_threshold<span class="w"> </span>FDEDUP_THRESHOLD
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">                        </span>threshold
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">  </span>--fdedup_shingles_size<span class="w"> </span>FDEDUP_SHINGLES_SIZE
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">                        </span>number<span class="w"> </span>of<span class="w"> </span>words<span class="w"> </span><span class="k">in</span><span class="w"> </span>shingle
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span>--fdedup_delimiters<span class="w"> </span>FDEDUP_DELIMITERS
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">                        </span>delimiter<span class="w"> </span><span class="k">for</span><span class="w"> </span>splitting<span class="w"> </span>document
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">  </span>--fdedup_snapshot_delay<span class="w"> </span>FDEDUP_SNAPSHOT_DELAY
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">                        </span>snapshot<span class="w"> </span>delay<span class="w"> </span><span class="nb">time</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">  </span>--fdedup_use_bucket_snapshot<span class="w"> </span>FDEDUP_USE_BUCKET_SNAPSHOT
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">                        </span>flag<span class="w"> </span>to<span class="w"> </span><span class="k">continue</span><span class="w"> </span>with<span class="w"> </span>bucket<span class="w"> </span>snapshot
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">  </span>--fdedup_use_doc_snapshot<span class="w"> </span>FDEDUP_USE_DOC_SNAPSHOT
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">                        </span>flag<span class="w"> </span>to<span class="w"> </span><span class="k">continue</span><span class="w"> </span>with<span class="w"> </span>doc<span class="w"> </span>snapshot
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">  </span>--fdedup_random_delay_limit<span class="w"> </span>FDEDUP_RANDOM_DELAY_LIMIT
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">                        </span>maximum<span class="w"> </span>delay<span class="w"> </span>between<span class="w"> </span><span class="nb">read</span>
</span></code></pre></div>
<p>These correspond to the configuration keys described above.</p>
<h3 id="running-the-samples">Running the samples</h3>
<p>To run the samples, use the following <code>make</code> targets</p>
<ul>
<li><code>run-cli-sample</code> - runs src/fdedup_transform_ray.py using command line args</li>
<li><code>run-local-sample</code> - runs src/fdedup_local_ray.py</li>
<li><code>run-s3-sample</code> - runs src/fdedup_s3_ray.py<ul>
<li>Requires prior installation of minio, depending on your platform (e.g., from <a href="https://min.io/docs/minio/macos/index.html">here</a>
 and <a href="https://min.io/docs/minio/linux/index.html">here</a> 
 and invocation of <code>make minio-start</code> to load data into local minio for S3 access.</li>
</ul>
</li>
</ul>
<p>These targets will activate the virtual environment and set up any configuration needed.
Use the <code>-n</code> option of <code>make</code> to see the detail of what is done to run the sample.</p>
<p>For example, 
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>make<span class="w"> </span>run-cli-sample
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>...
</span></code></pre></div>
Then 
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ls<span class="w"> </span>output
</span></code></pre></div>
To see results of the transform.</p>
<h3 id="transforming-data-using-the-transform-image">Transforming data using the transform image</h3>
<p>To use the transform image to transform your data, please refer to the 
<a href="../../../../doc/quick-start/run-transform-image/">running images quickstart</a>,
substituting the name of this transform image and runtime as appropriate.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../../assets/javascripts/badge.js" async></script>
      
    
  </body>
</html>