#!/bin/bash

# Function to copy and edit config files
copy_and_edit_config() {
    local source="$1"
    local destination="$2"

    # Copy the config file
    cp -f "$(brew --prefix)/etc/clamav/$source.sample" "$destination"

    # Edit the config file
    sed -i '' -e 's/^Example/# Example/' "$destination"
    echo "DatabaseDirectory /var/lib/clamav" >> "$destination"
}

# Install ClamAV with Homebrew
brew install clamav

# Copy and edit clamd.conf
copy_and_edit_config "clamd.conf" "$(brew --prefix)/etc/clamav/clamd.conf"

# Copy and edit freshclam.conf
copy_and_edit_config "freshclam.conf" "$(brew --prefix)/etc/clamav/freshclam.conf"

# Create directories and set permissions
directories=( "/var/run/clamav" "/var/lib/clamav" )
for dir in "${directories[@]}"; do
    if [ ! -e "$dir" ]; then
        sudo mkdir -p "$dir"
    fi
    sudo chown $(id -u):$(id -g) "$dir"
done

# Update ClamAV database
freshclam